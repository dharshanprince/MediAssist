<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - MediAssist</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="{{ url_for('index') }}">MediAssist</a></h1>
            <div class="user-info">
                <span>Welcome, {{ username }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-outline">Logout</a>
            </div>
        </div>
    </header>

    <main class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash-messages">
                    {% for message in messages %}
                        <div class="flash-message">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="dashboard-tabs">
            <button class="tab-button active" data-tab="personal-info">Personal Information</button>
            <button class="tab-button" data-tab="upload-reports">Upload Reports</button>
            <button class="tab-button" data-tab="view-reports">View Reports</button>
        </div>

        <div class="tab-content active" id="personal-info">
            <h2>Personal Information</h2>
            <form method="POST" action="{{ url_for('save_patient_data') }}">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" value="{{ patient_data.personal_info.get('name', '') }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" name="age" value="{{ patient_data.personal_info.get('age', '') }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male" {% if patient_data.personal_info.get('gender') == 'male' %}selected{% endif %}>Male</option>
                            <option value="female" {% if patient_data.personal_info.get('gender') == 'female' %}selected{% endif %}>Female</option>
                            <option value="other" {% if patient_data.personal_info.get('gender') == 'other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="blood_group">Blood Group</label>
                        <select id="blood_group" name="blood_group" required>
                            <option value="">Select Blood Group</option>
                            <option value="A+" {% if patient_data.personal_info.get('blood_group') == 'A+' %}selected{% endif %}>A+</option>
                            <option value="A-" {% if patient_data.personal_info.get('blood_group') == 'A-' %}selected{% endif %}>A-</option>
                            <option value="B+" {% if patient_data.personal_info.get('blood_group') == 'B+' %}selected{% endif %}>B+</option>
                            <option value="B-" {% if patient_data.personal_info.get('blood_group') == 'B-' %}selected{% endif %}>B-</option>
                            <option value="AB+" {% if patient_data.personal_info.get('blood_group') == 'AB+' %}selected{% endif %}>AB+</option>
                            <option value="AB-" {% if patient_data.personal_info.get('blood_group') == 'AB-' %}selected{% endif %}>AB-</option>
                            <option value="O+" {% if patient_data.personal_info.get('blood_group') == 'O+' %}selected{% endif %}>O+</option>
                            <option value="O-" {% if patient_data.personal_info.get('blood_group') == 'O-' %}selected{% endif %}>O-</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="contact">Contact Number</label>
                        <input type="tel" id="contact" name="contact" value="{{ patient_data.personal_info.get('contact', '') }}" required>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="address">Address</label>
                        <textarea id="address" name="address" required>{{ patient_data.personal_info.get('address', '') }}</textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="medical_history">Medical History</label>
                        <textarea id="medical_history" name="medical_history">{{ patient_data.personal_info.get('medical_history', '') }}</textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="allergies">Allergies</label>
                        <textarea id="allergies" name="allergies">{{ patient_data.personal_info.get('allergies', '') }}</textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="current_medications">Current Medications</label>
                        <textarea id="current_medications" name="current_medications">{{ patient_data.personal_info.get('current_medications', '') }}</textarea>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Save Information</button>
            </form>
        </div>

        <div class="tab-content" id="upload-reports">
            <h2>Upload Medical Reports</h2>
            <form method="POST" action="{{ url_for('upload_report') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="report_type">Report Type</label>
                    <select id="report_type" name="report_type" required>
                        <option value="">Select Report Type</option>
                        <option value="blood_test">Blood Test</option>
                        <option value="xray">X-Ray</option>
                        <option value="mri">MRI Scan</option>
                        <option value="ct_scan">CT Scan</option>
                        <option value="ultrasound">Ultrasound</option>
                        <option value="ecg">ECG</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="report">Select Report File</label>
                    <input type="file" id="report" name="report" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" required>
                    <small>Allowed formats: PDF, JPG, JPEG, PNG, DOC, DOCX</small>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" placeholder="Any additional notes about this report"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">Upload Report</button>
            </form>
        </div>

        <div class="tab-content" id="view-reports">
            <h2>Your Medical Reports</h2>
            
            {% if patient_data.reports %}
                <div class="reports-list">
                    {% for report in patient_data.reports %}
                        <div class="report-card">
                            <div class="report-info">
                                <h3>{{ report.report_type|title }}</h3>
                                <p><strong>File:</strong> {{ report.filename }}</p>
                                <p><strong>Uploaded:</strong> {{ report.upload_date }}</p>
                                {% if report.notes %}
                                    <p><strong>Notes:</strong> {{ report.notes }}</p>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No reports uploaded yet.</p>
            {% endif %}
        </div>
    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>