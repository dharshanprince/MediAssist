<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediAssist</title>
    <style>
      /* inlined style.css (truncated/kept full from project) */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f8f9fa;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      header {
        background-color: #2c3e50;
        color: white;
        padding: 1rem 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      header .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      header h1 a {
        color: white;
        text-decoration: none;
      }
      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .user-info span {
        font-weight: 500;
      }
      main {
        padding: 2rem 0;
        min-height: calc(100vh - 140px);
      }
      .hero {
        text-align: center;
        padding: 3rem 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        margin-bottom: 3rem;
      }
      .hero h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }
      .cta-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }
      .feature-card {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s;
      }
      .feature-card:hover {
        transform: translateY(-5px);
      }
      .btn {
        display: inline-block;
        padding: 12px 24px;
        border: none;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
      }
      .btn-primary {
        background: #3498db;
        color: white;
      }
      .btn-secondary {
        background: #2ecc71;
        color: white;
      }
      .btn-outline {
        background: transparent;
        color: white;
        border: 2px solid white;
      }
      .auth-container {
        max-width: 400px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .auth-container h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: #2c3e50;
      }
      .form-group {
        margin-bottom: 1.5rem;
      }
      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2c3e50;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 5px;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #3498db;
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      .dashboard-tabs {
        display: flex;
        border-bottom: 2px solid #e1e8ed;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }
      .tab-button {
        padding: 12px 24px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        color: #7f8c8d;
        border-bottom: 3px solid transparent;
      }
      .tab-button.active {
        color: #3498db;
        border-bottom-color: #3498db;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      .flash-messages {
        margin-bottom: 2rem;
      }
      .flash-message {
        padding: 12px 20px;
        background: #e74c3c;
        color: white;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      .patients-list,
      .reports-list {
        display: grid;
        gap: 1.5rem;
      }
      .patient-card,
      .report-card {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 1rem;
      }
      footer {
        background: #2c3e50;
        color: white;
        text-align: center;
        padding: 1.5rem 0;
        margin-top: 3rem;
      }
      @media (max-width: 768px) {
        header .container {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <h1><a href="#" data-nav="home">MediAssist</a></h1>
        <div class="user-info" id="top-user-info">
          <span id="welcome-text" style="display: none"
            >Welcome, <strong id="user-name"></strong
          ></span>
          <button class="btn btn-outline" id="logout-btn" style="display: none">
            Logout
          </button>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- Navigation -->
      <nav style="margin: 1rem 0; display: flex; gap: 10px; flex-wrap: wrap">
        <div class="dropdown" style="position: relative;">
            <button class="btn btn-primary" id="menu-toggle-btn" type="button">Menu &#x25BC;</button>
            <div id="menu-dropdown" style="display: none; position: absolute; left: 0; top: 110%; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.15); border-radius: 6px; min-width: 180px; z-index: 10;">
                <a href="#home" data-nav="home" class="btn" style="display: block; width: 100%; text-align: left; color: #333; background: none; border: none; padding: 12px 20px;">Home</a>
                <a href="#login" data-nav="login" class="btn" style="display: block; width: 100%; text-align: left; color: #333; background: none; border: none; padding: 12px 20px;">Login / Signup</a>
                <a href="#patient" data-nav="patient" class="btn" style="display: block; width: 100%; text-align: left; color: #333; background: none; border: none; padding: 12px 20px;">Patient Dashboard</a>
                <a href="#doctor" data-nav="doctor" class="btn" style="display: block; width: 100%; text-align: left; color: #333; background: none; border: none; padding: 12px 20px;">Doctor Dashboard</a>
                <a href="#profile" data-nav="profile" class="btn" style="display: block; width: 100%; text-align: left; color: #333; background: none; border: none; padding: 12px 20px;">Patient Profile</a>
            </div>
        </div>
        <script>
            // Dropdown menu logic
            const menuBtn = document.getElementById('menu-toggle-btn');
            const menuDropdown = document.getElementById('menu-dropdown');
            menuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                menuDropdown.style.display = menuDropdown.style.display === 'block' ? 'none' : 'block';
            });
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!menuDropdown.contains(e.target) && e.target !== menuBtn) {
                    menuDropdown.style.display = 'none';
                }
            });
            // Hide dropdown on menu item click
            menuDropdown.querySelectorAll('a').forEach(function(link) {
                link.addEventListener('click', function() {
                    menuDropdown.style.display = 'none';
                });
            });
        </script>
      </nav>

      <!-- Home (from dashboard.html) -->
      <section id="home" class="page-section">
        <section class="hero">
          <h2>Secure Medical Data Management</h2>
          <p>
            Store, manage, and access your medical records anytime, anywhere
          </p>
          <div class="cta-buttons">
            <button class="btn btn-primary" data-nav="login">Login</button>
            <button class="btn btn-secondary" data-nav="login">Sign Up</button>
          </div>
        </section>

        <section class="features">
          <div class="feature-card">
            <h3>For Patients</h3>
            <p>
              Store your medical history, upload reports, and maintain your
              health records securely
            </p>
          </div>
          <div class="feature-card">
            <h3>For Doctors</h3>
            <p>
              Access patient records, review medical history, and provide better
              care
            </p>
          </div>
          <div class="feature-card">
            <h3>Mobile Friendly</h3>
            <p>Access your medical data on any device, anytime you need it</p>
          </div>
        </section>
      </section>

      <!-- Login / Signup (from login.html) -->
      <section id="login" class="page-section" style="display: none">
        <div class="auth-container">
          <h2 id="auth-title">Login to MediAssist</h2>

          <div
            class="flash-messages"
            id="auth-flash"
            style="display: none"
          ></div>

          <form id="auth-form">
            <div class="form-group">
              <label for="username">Username</label>
              <input type="text" id="username" name="username" required />
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input type="password" id="password" name="password" required />
            </div>
            <div class="form-group">
              <label for="user_type">I am a</label>
              <select id="user_type" name="user_type" required>
                <option value="patient">Patient</option>
                <option value="doctor">Doctor</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary" id="auth-submit">
              Login
            </button>
            <button type="button" class="btn" id="toggle-signup">
              Switch to Sign Up
            </button>
          </form>
        </div>
      </section>

      <!-- Patient Dashboard (from Patient Dashboard.html) -->
      <section id="patient" class="page-section" style="display: none">
        <div class="dashboard-tabs">
          <button class="tab-button active" data-tab="personal-info">
            Personal Information
          </button>
          <button class="tab-button" data-tab="upload-reports">
            Upload Reports
          </button>
          <button class="tab-button" data-tab="view-reports">
            View Reports
          </button>
        </div>

        <div class="tab-content active" id="personal-info">
          <h2>Personal Information</h2>
          <form id="personal-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="p_name">Full Name</label>
                <input type="text" id="p_name" name="name" required />
              </div>
              <div class="form-group">
                <label for="p_age">Age</label>
                <input type="number" id="p_age" name="age" required />
              </div>
              <div class="form-group">
                <label for="p_gender">Gender</label>
                <select id="p_gender" name="gender" required>
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="p_blood">Blood Group</label>
                <select id="p_blood" name="blood_group" required>
                  <option value="">Select Blood Group</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                </select>
              </div>
              <div class="form-group">
                <label for="p_contact">Contact Number</label>
                <input type="tel" id="p_contact" name="contact" required />
              </div>
              <div class="form-group full-width">
                <label for="p_address">Address</label>
                <textarea id="p_address" name="address" required></textarea>
              </div>
              <div class="form-group full-width">
                <label for="p_history">Medical History</label>
                <textarea id="p_history" name="medical_history"></textarea>
              </div>
              <div class="form-group full-width">
                <label for="p_allergies">Allergies</label>
                <textarea id="p_allergies" name="allergies"></textarea>
              </div>
              <div class="form-group full-width">
                <label for="p_meds">Current Medications</label>
                <textarea id="p_meds" name="current_medications"></textarea>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">
              Save Information
            </button>
          </form>
        </div>

        <div class="tab-content" id="upload-reports">
          <h2>Upload Medical Reports</h2>
          <form id="upload-form">
            <div class="form-group">
              <label for="report_type">Report Type</label>
              <select id="report_type" name="report_type" required>
                <option value="">Select Report Type</option>
                <option value="blood_test">Blood Test</option>
                <option value="xray">X-Ray</option>
                <option value="mri">MRI Scan</option>
                <option value="ct_scan">CT Scan</option>
                <option value="ultrasound">Ultrasound</option>
                <option value="ecg">ECG</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="report">Select Report File</label>
              <input
                type="file"
                id="report"
                name="report"
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
              />
              <small>Allowed formats: PDF, JPG, JPEG, PNG, DOC, DOCX</small>
            </div>
            <div style="text-align: right; margin-bottom: 1rem">
              <button
                class="btn btn-secondary"
                id="open-camera-btn"
                type="button"
              >
                Scan Report with Camera
              </button>
            </div>
            <div
              id="camera-modal"
              style="
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.7);
                align-items: center;
                justify-content: center;
              "
            >
              <div
                style="
                  background: #fff;
                  padding: 2rem;
                  border-radius: 10px;
                  max-width: 400px;
                  margin: auto;
                  position: relative;
                "
              >
                <button
                  id="close-camera"
                  style="
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                  "
                >
                  &times;
                </button>
                <h3>Scan Report Image</h3>
                <video
                  id="camera-video"
                  width="320"
                  height="240"
                  autoplay
                  style="border-radius: 8px; background: #222"
                ></video>
                <canvas
                  id="camera-canvas"
                  width="320"
                  height="240"
                  style="display: none"
                ></canvas>
                <div
                  style="
                    margin-top: 1rem;
                    display: flex;
                    gap: 10px;
                    justify-content: center;
                  "
                >
                  <button class="btn btn-primary" id="capture-btn">
                    Capture
                  </button>
                  <button class="btn" id="use-photo-btn" style="display: none">
                    Use Photo
                  </button>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="notes">Notes</label>
              <textarea
                id="notes"
                name="notes"
                placeholder="Any additional notes about this report"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              Upload Report (local)
            </button>
          </form>
        </div>
        <div class="tab-content" id="view-reports">
          <h2>Your Medical Reports</h2>
          <div id="reports-container"></div>
        </div>
      </section>

      <!-- Doctor Dashboard (from Doctor Dashboard.html) -->
      <section id="doctor" class="page-section" style="display: none">
        <h2>Patient Records (local view)</h2>
        <div class="search-container">
          <input
            type="text"
            id="doc-search"
            placeholder="Search patients by name or username"
          />
          <button class="btn btn-primary" id="doc-search-btn">Search</button>
        </div>
        <div id="patients-list" class="patients-list"></div>
      </section>

      <!-- Patient Profile (from Patient Profile.html) -->
      <section id="profile" class="page-section" style="display: none">
        <div class="patient-profile">
          <h2 id="profile-name"></h2>
          <p><strong>Username:</strong> <span id="profile-username"></span></p>
          <div class="profile-sections" id="profile-sections"></div>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2025 MediAssist. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // inlined script.js + small client logic
      document.addEventListener("DOMContentLoaded", function () {
        // Navigation between sections
        function showSection(id) {
          document
            .querySelectorAll(".page-section")
            .forEach((s) => (s.style.display = "none"));
          const el = document.getElementById(id);
          if (el) el.style.display = "block";
          // update URL hash without jump
          history.replaceState(null, "", "#" + id);
        }

        // initial show
        const initial = location.hash ? location.hash.replace("#", "") : "home";
        showSection(initial);

        document.querySelectorAll("[data-nav]").forEach((btn) => {
          btn.addEventListener("click", function (e) {
            const id = this.getAttribute("data-nav");
            showSection(id);
          });
        });

        // Tab switching (patient dashboard)
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabContents = document.querySelectorAll(".tab-content");
        if (tabButtons.length > 0) {
          tabButtons.forEach((button) => {
            button.addEventListener("click", function () {
              const tabId = this.getAttribute("data-tab");
              tabButtons.forEach((btn) => btn.classList.remove("active"));
              tabContents.forEach((content) =>
                content.classList.remove("active")
              );
              this.classList.add("active");
              document.getElementById(tabId).classList.add("active");
            });
          });
        }

        // Flash helper
        function flash(msg) {
          const container = document.getElementById("auth-flash");
          container.style.display = "block";
          container.textContent = msg;
          setTimeout(() => (container.style.display = "none"), 4000);
        }

        // Simple auth simulation using localStorage
        const authForm = document.getElementById("auth-form");
        const authTitle = document.getElementById("auth-title");
        const toggleSignup = document.getElementById("toggle-signup");
        let signupMode = false;

        toggleSignup.addEventListener("click", () => {
          signupMode = !signupMode;
          authTitle.textContent = signupMode
            ? "Create an Account"
            : "Login to MediAssist";
          document.getElementById("auth-submit").textContent = signupMode
            ? "Sign Up"
            : "Login";
        });

        authForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const u = document.getElementById("username").value.trim();
          const p = document.getElementById("password").value;
          const role = document.getElementById("user_type").value;
          if (!u || !p) {
            flash("Please enter username and password");
            return;
          }

          // simple storage of users
          const users = JSON.parse(localStorage.getItem("ma_users") || "{}");
          if (signupMode) {
            if (users[u]) {
              flash("Username already exists");
              return;
            }
            users[u] = { password: p, role };
            localStorage.setItem("ma_users", JSON.stringify(users));
            flash("Account created. You can now login.");
            signupMode = false;
            authTitle.textContent = "Login to MediAssist";
            document.getElementById("auth-submit").textContent = "Login";
            return;
          }

          if (users[u] && users[u].password === p) {
            localStorage.setItem(
              "ma_current",
              JSON.stringify({ username: u, role })
            );
            updateUserUI();
            showSection(role === "doctor" ? "doctor" : "patient");
          } else {
            flash("Invalid credentials. For demo create an account first.");
          }
        });

        function updateUserUI() {
          const cur = JSON.parse(localStorage.getItem("ma_current") || "null");
          if (cur) {
            document.getElementById("welcome-text").style.display = "inline";
            document.getElementById("user-name").textContent = cur.username;
            document.getElementById("logout-btn").style.display =
              "inline-block";
            document.getElementById("top-user-info").style.display = "flex";
          } else {
            document.getElementById("welcome-text").style.display = "none";
            document.getElementById("logout-btn").style.display = "none";
          }
        }

        document.getElementById("logout-btn").addEventListener("click", () => {
          localStorage.removeItem("ma_current");
          updateUserUI();
          showSection("home");
        });

        updateUserUI();

        // Personal info save + load
        const pForm = document.getElementById("personal-form");
        pForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const cur = JSON.parse(localStorage.getItem("ma_current") || "null");
          if (!cur) {
            flash("Please login as patient to save info");
            return;
          }
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          pd[cur.username] = pd[cur.username] || {
            personal_info: {},
            reports: [],
          };
          pd[cur.username].personal_info = {
            name: document.getElementById("p_name").value,
            age: document.getElementById("p_age").value,
            gender: document.getElementById("p_gender").value,
            blood_group: document.getElementById("p_blood").value,
            contact: document.getElementById("p_contact").value,
            address: document.getElementById("p_address").value,
            medical_history: document.getElementById("p_history").value,
            allergies: document.getElementById("p_allergies").value,
            current_medications: document.getElementById("p_meds").value,
          };
          localStorage.setItem("ma_data", JSON.stringify(pd));
          flash("Patient data saved locally");
        });

        // Load personal info when patient page shown
        function loadPersonalInfo() {
          const cur = JSON.parse(localStorage.getItem("ma_current") || "null");
          if (!cur) return;
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          const my = (pd[cur.username] && pd[cur.username].personal_info) || {};
          document.getElementById("p_name").value = my.name || "";
          document.getElementById("p_age").value = my.age || "";
          document.getElementById("p_gender").value = my.gender || "";
          document.getElementById("p_blood").value = my.blood_group || "";
          document.getElementById("p_contact").value = my.contact || "";
          document.getElementById("p_address").value = my.address || "";
          document.getElementById("p_history").value = my.medical_history || "";
          document.getElementById("p_allergies").value = my.allergies || "";
          document.getElementById("p_meds").value =
            my.current_medications || "";
        }

        // Upload report (client-side only): store file name and metadata in localStorage
        const uploadForm = document.getElementById("upload-form");
        uploadForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const cur = JSON.parse(localStorage.getItem("ma_current") || "null");
          if (!cur || cur.role !== "patient") {
            flash("Please login as patient to upload reports");
            return;
          }
          const fileInput = document.getElementById("report");
          const file = fileInput.files[0];
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          pd[cur.username] = pd[cur.username] || {
            personal_info: {},
            reports: [],
          };
          const report = {
            filename: file ? file.name : "(no-file)",
            report_type: document.getElementById("report_type").value,
            notes: document.getElementById("notes").value,
            upload_date: new Date().toLocaleString(),
          };
          pd[cur.username].reports.push(report);
          localStorage.setItem("ma_data", JSON.stringify(pd));
          flash("Report saved locally");
          fileInput.value = "";
          renderReports();
        });

        function renderReports() {
          const cur = JSON.parse(localStorage.getItem("ma_current") || "null");
          const container = document.getElementById("reports-container");
          container.innerHTML = "";
          if (!cur) {
            container.innerHTML = "<p>Please login to see reports.</p>";
            return;
          }
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          const reports = (pd[cur.username] && pd[cur.username].reports) || [];
          if (!reports.length) {
            container.innerHTML = "<p>No reports uploaded yet.</p>";
            return;
          }
          reports.forEach((r) => {
            const div = document.createElement("div");
            div.className = "report-card";
            div.innerHTML = `<div class="report-info"><h3>${(
              r.report_type || "Report"
            ).replace("_", " ")}</h3><p><strong>File:</strong> ${
              r.filename
            }</p><p><strong>Uploaded:</strong> ${r.upload_date}</p>${
              r.notes ? `<p><strong>Notes:</strong> ${r.notes}</p>` : ""
            }</div>`;
            container.appendChild(div);
          });
        }

        // Doctor view: list all patients saved locally
        function renderPatients(filter = "") {
          const list = document.getElementById("patients-list");
          list.innerHTML = "";
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          const users = Object.keys(pd);
          if (!users.length) {
            list.innerHTML = "<p>No patients found in local data.</p>";
            return;
          }
          users.forEach((u) => {
            const info = pd[u].personal_info || {};
            if (
              filter &&
              !(
                u.toLowerCase().includes(filter.toLowerCase()) ||
                (info.name &&
                  info.name.toLowerCase().includes(filter.toLowerCase()))
              )
            )
              return;
            const div = document.createElement("div");
            div.className = "patient-card";
            div.innerHTML = `<div class="patient-info"><h3>${
              info.name || u
            }</h3><p><strong>Username:</strong> ${u}</p>${
              info.age ? `<p><strong>Age:</strong> ${info.age}</p>` : ""
            }${
              info.gender
                ? `<p><strong>Gender:</strong> ${info.gender}</p>`
                : ""
            }${
              info.blood_group
                ? `<p><strong>Blood Group:</strong> ${info.blood_group}</p>`
                : ""
            }</div><div class="patient-actions"><button class="btn btn-primary view-profile" data-username="${u}">View Full Profile</button></div>`;
            list.appendChild(div);
          });
          document.querySelectorAll(".view-profile").forEach((b) =>
            b.addEventListener("click", function () {
              openProfile(this.getAttribute("data-username"));
            })
          );
        }

        function openProfile(username) {
          const pd = JSON.parse(localStorage.getItem("ma_data") || "{}");
          const data = pd[username] || { personal_info: {}, reports: [] };
          document.getElementById("profile-name").textContent =
            data.personal_info.name || username;
          document.getElementById("profile-username").textContent = username;
          const sec = document.getElementById("profile-sections");
          sec.innerHTML = "";
          const info = data.personal_info || {};
          const addSection = (title, html) => {
            const d = document.createElement("div");
            d.className = "profile-section";
            d.innerHTML = `<h3>${title}</h3>${html}`;
            sec.appendChild(d);
          };
          let infoHtml = '<div class="info-grid">';
          if (info.age)
            infoHtml += `<div class="info-item"><strong>Age:</strong> ${info.age}</div>`;
          if (info.gender)
            infoHtml += `<div class="info-item"><strong>Gender:</strong> ${info.gender}</div>`;
          if (info.blood_group)
            infoHtml += `<div class="info-item"><strong>Blood Group:</strong> ${info.blood_group}</div>`;
          if (info.contact)
            infoHtml += `<div class="info-item"><strong>Contact:</strong> ${info.contact}</div>`;
          if (info.address)
            infoHtml += `<div class="info-item full-width"><strong>Address:</strong> ${info.address}</div>`;
          infoHtml += "</div>";
          addSection("Personal Information", infoHtml);
          if (info.medical_history)
            addSection("Medical History", `<p>${info.medical_history}</p>`);
          if (info.allergies)
            addSection("Allergies", `<p>${info.allergies}</p>`);
          if (info.current_medications)
            addSection(
              "Current Medications",
              `<p>${info.current_medications}</p>`
            );
          if (data.reports && data.reports.length) {
            let rhtml = "";
            data.reports.forEach((r) => {
              rhtml += `<div class="report-card"><div class="report-info"><h4>${
                r.report_type
              }</h4><p><strong>File:</strong> ${
                r.filename
              }</p><p><strong>Uploaded:</strong> ${r.upload_date}</p>${
                r.notes ? `<p><strong>Notes:</strong> ${r.notes}</p>` : ""
              }</div></div>`;
            });
            addSection("Medical Reports", rhtml);
          }
          showSection("profile");
        }

        // When patient section shown, load personal info and reports
        document.querySelectorAll("[data-nav]").forEach((btn) =>
          btn.addEventListener("click", () => {
            setTimeout(() => {
              loadPersonalInfo();
              renderReports();
              renderPatients();
            }, 100);
          })
        );

        // Doctor search
        document
          .getElementById("doc-search-btn")
          .addEventListener("click", () => {
            renderPatients(document.getElementById("doc-search").value);
          });

        // Initialize render
        renderReports();
        renderPatients();
        // show personal info if already logged in and on patient
        if (initial === "patient") loadPersonalInfo();
      });
    </script>
  </body>
</html>
